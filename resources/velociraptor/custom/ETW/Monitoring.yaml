name: Windows.ETW.Monitoring
description: |
  This artifact contains

  This artifact was built on 2025-05-17T02:07:23Z

type: CLIENT_EVENT

parameters:
  - name: RuleLevel
    type: choices
    default: All
    choices:
      - "Critical"
      - "Critical and High"
      - "Critical, High, and Medium"
      - "All"

  - name: RuleStatus
    type: choices
    default: All Rules
    choices:
      - Stable
      - Stable and Experimental
      - Stable and Test
      - All Rules

  - name: RuleTitleFilter
    type: regex
    default: .
    description: Use this to filter only some rules to match

  - name: RuleExclusions
    type: csv
    description: |
      Some rules in the Hayabusa set are extremely noisy, so they
      are disabled by default.
    default: |
      RuleTitleRegex,Reason
      Proc Exec,Fires on every Process Execution EID 1
      File Created,Fires on every Sysmon EID 11
      Reg Key Value Set,Fires on every Sysmon EID 13
      DNS Query,Fires on every Sysmon EID 22
      Proc Terminated$,Fires on every Sysmon EID 5
      Proc Injection$,Fires on every Sysmon EID 8
      Reg Key Create/Delete,Fires on every Sysmon EID 12
      WMI Provider Started,Fires on every Microsoft-Windows-WMI-Activity/Operational EID 5857
      noisy,All rules marked noisy should be disabled by default.

  - name: DateAfter
    description: "search for events after this date. YYYY-MM-DDTmm:hh:ss Z"
    type: timestamp

  - name: DateBefore
    description: "search for events before this date. YYYY-MM-DDTmm:hh:ss Z"
    type: timestamp

imports:
  - Windows.Sigma.ETWBase
export: |
     LET SigmaRules <= gunzip(string=base64decode(string="H4sIAAAAAAAA/9ST0WvbMBDG3/VX3MMMGyMZtG9+K1k6Spek1GVhIFYU6UsqIktBku0Y9scPy56XbGX0YXvoW+50d9/d94ujjgY5zTwUbNTCBBJSIgTaelfSRsh9dQhUa0H3lVXGXF4w43bBVV4iZ0RSROycb3NCbBjRwTtVyZhTo61yTWBEAb7WEjnt4S0MU4iQUTub+p1VOgX0FrF5PHiX5IVVNPx+tKJESkhXlsIqoy3epd4x7EYRzfrEZ23x3Q85ognd3hdPrrlFu9j5MblHW+78VBnDiE6k+7Z5DRsf2gNyuuvzRRQ+9heOW/W1Q8FSlEmW/ODUFEcwgxomJ4WtqEzsjhfahHEqZSfdGRlRWfkERdnJLRljk8mE/cGKlA7S1fBtAvSlE5iVqpd9dZA+GB2i9FAhX/drnf4tny3D5reSv2GceYiIwe0XcTw39F9zvNYGPz+26Ki4WpASUWxE+I/0Akz/kFBZFwlHaaqgne1gjcGZIfPjOalv05zzO+92XpTpjMD5+eMAkPOiDRHl5QXnJogQkpPduubXepRGjKZP369vlh9X64Lz4mvxMF90zbPV8vrmE+fF1eLN81y7GS9mND8iG6yHom0HIlsdYLshGfsRAAD//w8pNIwUBQAA"))
sources:
- query: |
    SELECT *
    FROM Artifact.Windows.Sigma.ETWBase(
       RuleLevel=RuleLevel, RuleStatus=RuleStatus,
       RuleTitleFilter=RuleTitleFilter, RuleExclusions=RuleExclusions,
       SigmaRules=SigmaRules)
